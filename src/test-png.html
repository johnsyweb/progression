<!DOCTYPE html>
<html>
<head>
  <title>Test PNG Generation</title>
</head>
<body>
  <h1>PNG Image Test</h1>
  <p>Testing PNG generation via service worker:</p>
  <img id="png-image" alt="OG Image PNG" style="max-width: 100%; border: 1px solid #ccc;" />
  <p id="status">Loading...</p>
  
  <script>
    const imageUrl = '/progression/og-image.svg?path=%2Fprogression%2F2024-01-01%2F2026-12-31%2Ffoo%2520bar';
    const img = document.getElementById('png-image');
    const status = document.getElementById('status');
    
    img.onload = () => {
      status.textContent = '✅ PNG image loaded successfully!';
      status.style.color = 'green';
      console.log('Image loaded:', img.naturalWidth, 'x', img.naturalHeight);
    };
    
    img.onerror = (e) => {
      status.textContent = '❌ Failed to load PNG image. Check console for details.';
      status.style.color = 'red';
      console.error('Image load error:', e);
    };
    
    // Check if service worker is registered
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(registrations => {
        console.log('Service worker registrations:', registrations.length);
        if (registrations.length > 0) {
          console.log('Service worker scope:', registrations[0].scope);
        }
      });
      
      navigator.serviceWorker.ready.then(() => {
        console.log('Service worker is ready');
        status.textContent = '✅ Service worker ready, loading image...';
        img.src = imageUrl;
      }).catch(err => {
        console.error('Service worker not ready:', err);
        status.textContent = '⚠️ Service worker not ready. Loading image anyway...';
        img.src = imageUrl;
      });
      
      // Also try loading immediately
      img.src = imageUrl;
    } else {
      status.textContent = '❌ Service workers not supported';
      status.style.color = 'red';
    }
    
    // Log network requests
    img.addEventListener('load', () => {
      console.log('Image loaded successfully');
      console.log('Image dimensions:', img.naturalWidth, 'x', img.naturalHeight);
      console.log('Image src:', img.src);
    });
    
    img.addEventListener('error', (e) => {
      console.error('Image failed to load:', e);
      console.error('Failed URL:', img.src);
    });
  </script>
</body>
</html>

