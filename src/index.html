<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="theme-color"
      content="#fafafa"
      media="(prefers-color-scheme: light)"
    />
    <meta
      name="theme-color"
      content="#121212"
      media="(prefers-color-scheme: dark)"
    />
    <title>Progress | www.johnsy.com</title>
    <meta
      name="description"
      content="Track progress through time with a visual progress bar. Set start and end dates to see how far you've come."
    />
    <link rel="canonical" href="" />
    <meta name="author" content="Pete Johns" />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%231565c0'><path d='M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z'/></svg>"
    />
    <link rel="stylesheet" href="style.css" />

    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="Progress | www.johnsy.com" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="" />
    <meta property="og:description" content="" />
    <meta property="og:image" content="" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="800" />
    <meta property="og:site_name" content="www.johnsy.com" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="" />

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json" id="structured-data">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Progress | www.johnsy.com",
        "url": "",
        "publisher": {
          "@type": "Organization",
          "name": "johnsy.com",
          "url": "https://www.johnsy.com"
        },
        "author": {
          "@type": "Person",
          "name": "Pete Johns",
          "givenName": "Pete",
          "familyName": "Johns",
          "alternateName": "Pete Johns (/piːt ʤɒnz/)",
          "pronouns": "he/him/his",
          "jobTitle": "Head of Engineering",
          "url": "https://www.johnsy.com/contact/",
          "sameAs": [
            "https://github.com/johnsyweb",
            "https://www.flickr.com/people/johnsyweb/"
          ]
        },
        "description": "Track progress through time with a visual progress bar"
      }
    </script>
    <script type="application/ld+json" id="breadcrumb-data">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "johnsy.com",
            "item": "https://www.johnsy.com/"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Progression",
            "item": ""
          },
          { "@type": "ListItem", "position": 3, "name": "Progress", "item": "" }
        ]
      }
    </script>
    <script>
      (function () {
        const path = window.location.pathname;
        const baseUrl = window.location.origin;
        const baseTag = document.querySelector("base");
        let basePath = "/";
        if (baseTag && baseTag.href) {
          try {
            const baseUrlObj = new URL(baseTag.href);
            basePath = baseUrlObj.pathname.endsWith("/")
              ? baseUrlObj.pathname.slice(0, -1)
              : baseUrlObj.pathname;
          } catch {
            basePath = "/";
          }
        }
        const ogUrl = baseUrl + (path === "/" ? "" : path);

        // Extract title from path
        let title = "Progress";
        let strippedPath = path;
        if (basePath !== "/" && path.startsWith(basePath)) {
          strippedPath = path.slice(basePath.length) || "/";
        }
        const parts = strippedPath.split("/").filter((part) => part.length > 0);
        if (parts.length >= 3) {
          title = decodeURIComponent(parts.slice(2).join("/"));
        } else if (parts.length === 2) {
          // If only dates, use current year as title
          const currentYear = new Date().getFullYear();
          title = currentYear.toString();
        }

        // Use PNG screenshot as OG image for better compatibility
        const normalizedBasePath =
          basePath === "/" ? "" : basePath.replace(/\/$/, "");
        const ogImagePath =
          normalizedBasePath === ""
            ? "/assets/screenshot.png"
            : `${normalizedBasePath}/assets/screenshot.png`;
        const ogImageUrl = baseUrl + ogImagePath;

        const ogTitleMeta = document.querySelector('meta[property="og:title"]');
        if (ogTitleMeta) {
          ogTitleMeta.setAttribute("content", `${title} | www.johnsy.com`);
        }

        const ogImageMeta = document.querySelector('meta[property="og:image"]');
        if (ogImageMeta) {
          ogImageMeta.setAttribute("content", ogImageUrl);
        }

        const ogUrlMeta = document.querySelector('meta[property="og:url"]');
        if (ogUrlMeta) {
          ogUrlMeta.setAttribute("content", ogUrl);
        }

        const twitterImageMeta = document.querySelector(
          'meta[name="twitter:image"]'
        );
        if (twitterImageMeta) {
          twitterImageMeta.setAttribute("content", ogImageUrl);
        }

        // Set description based on path
        // Parse dates from path to calculate status
        let description = "";
        if (parts.length >= 2) {
          try {
            const startDate = new Date(parts[0]);
            const endDate = new Date(parts[1]);
            const current = new Date();

            if (!isNaN(startDate.getTime()) && !isNaN(endDate.getTime())) {
              const totalMs = endDate.getTime() - startDate.getTime();
              const elapsedMs = current.getTime() - startDate.getTime();
              const totalDays = Math.round(totalMs / (1000 * 60 * 60 * 24));
              const elapsedDays = Math.round(elapsedMs / (1000 * 60 * 60 * 24));
              const remainingDays = totalDays - elapsedDays;

              let percentage = null;
              if (current >= startDate && current <= endDate) {
                percentage = (elapsedMs / totalMs) * 100;
              }

              if (percentage !== null) {
                description = `${percentage.toFixed(1)}% complete • ${elapsedDays} days elapsed • ${remainingDays} days remaining`;
              } else if (current < startDate) {
                const daysUntilStart = Math.round(
                  (startDate.getTime() - current.getTime()) /
                    (1000 * 60 * 60 * 24)
                );
                description = `Starting in ${daysUntilStart} day${daysUntilStart !== 1 ? "s" : ""}`;
              } else {
                const daysSinceEnd = Math.round(
                  (current.getTime() - endDate.getTime()) /
                    (1000 * 60 * 60 * 24)
                );
                description = `Completed ${daysSinceEnd} day${daysSinceEnd !== 1 ? "s" : ""} ago`;
              }
            }
          } catch (e) {
            // Ignore errors
          }
        }

        const ogDescriptionMeta = document.querySelector(
          'meta[property="og:description"]'
        );
        if (ogDescriptionMeta && description) {
          ogDescriptionMeta.setAttribute("content", description);
        }

        // Update canonical URL
        const canonicalLink = document.querySelector('link[rel="canonical"]');
        if (canonicalLink) {
          canonicalLink.setAttribute("href", ogUrl);
        }

        // Update meta description
        const metaDescription = document.querySelector(
          'meta[name="description"]'
        );
        if (metaDescription && description) {
          metaDescription.setAttribute("content", description);
        }

        // Update document title
        document.title = `${title} | www.johnsy.com`;

        // Update visible breadcrumbs and BreadcrumbList JSON-LD
        const progressionHref =
          normalizedBasePath === "" ? "/" : normalizedBasePath + "/";
        const progressionFullUrl =
          baseUrl +
          (normalizedBasePath === "" ? "/" : normalizedBasePath + "/");
        const breadcrumbProgression = document.getElementById(
          "breadcrumb-progression"
        );
        const headerProgressionLink = document.getElementById(
          "header-progression-link"
        );
        if (breadcrumbProgression) {
          breadcrumbProgression.href = progressionHref;
          breadcrumbProgression.setAttribute(
            "data-base-path",
            normalizedBasePath
          );
        }
        if (headerProgressionLink) {
          headerProgressionLink.href = progressionHref;
          headerProgressionLink.setAttribute(
            "data-base-path",
            normalizedBasePath
          );
        }
        const breadcrumbCurrent = document.getElementById("breadcrumb-current");
        if (breadcrumbCurrent) {
          breadcrumbCurrent.textContent = title;
        }
        const breadcrumbDataScript = document.getElementById("breadcrumb-data");
        if (breadcrumbDataScript) {
          const breadcrumbData = {
            "@context": "https://schema.org",
            "@type": "BreadcrumbList",
            itemListElement: [
              {
                "@type": "ListItem",
                position: 1,
                name: "johnsy.com",
                item: "https://www.johnsy.com/",
              },
              {
                "@type": "ListItem",
                position: 2,
                name: "Progression",
                item: progressionFullUrl,
              },
              { "@type": "ListItem", position: 3, name: title, item: ogUrl },
            ],
          };
          breadcrumbDataScript.textContent = JSON.stringify(breadcrumbData);
        }

        // Update JSON-LD structured data
        const structuredDataScript = document.getElementById("structured-data");
        if (structuredDataScript) {
          const structuredData = {
            "@context": "https://schema.org",
            "@type": "WebPage",
            name: `${title} | www.johnsy.com`,
            url: ogUrl,
            description:
              description ||
              "Track progress through time with a visual progress bar",
            author: {
              "@type": "Person",
              name: "Pete Johns",
              givenName: "Pete",
              familyName: "Johns",
              alternateName: "Pete Johns (/piːt ʤɒnz/)",
              pronouns: "he/him/his",
              jobTitle: "Head of Engineering",
              url: "https://www.johnsy.com/contact/",
              sameAs: [
                "https://github.com/johnsyweb",
                "https://www.flickr.com/people/johnsyweb/",
              ],
            },
            publisher: {
              "@type": "Organization",
              name: "johnsy.com",
              url: "https://www.johnsy.com",
            },
          };
          structuredDataScript.textContent = JSON.stringify(structuredData);
        }
      })();
    </script>
  </head>
  <body>
    <header id="header">
      <div class="header-inner">
        <nav class="breadcrumbs" aria-label="Breadcrumb" id="breadcrumb-nav">
          <a href="https://www.johnsy.com/">johnsy.com</a>
          <span aria-hidden="true">/</span>
          <a href="" id="breadcrumb-progression" data-base-path=""
            >Progression</a
          >
          <span aria-hidden="true">/</span>
          <span aria-current="page" id="breadcrumb-current">Progress</span>
        </nav>
        <h1>
          <a href="" id="header-progression-link" data-base-path=""
            >Progression</a
          >
        </h1>
      </div>
    </header>

    <div id="page">
      <main id="content" role="main">
        <div id="progress-container"></div>
      </main>

      <div id="accesskeys" class="accesskeys">
        <p class="accesskeys-title">Keyboard shortcuts:</p>
        <ul class="accesskeys-list" id="accesskeys-list">
          <li>
            <kbd id="accesskey-title"
              ><span class="modifier-key">Alt</span>+T</kbd
            >
            Edit title
          </li>
          <li>
            <kbd id="accesskey-start"
              ><span class="modifier-key">Alt</span>+S</kbd
            >
            Edit start date
          </li>
          <li>
            <kbd id="accesskey-end"
              ><span class="modifier-key">Alt</span>+E</kbd
            >
            Edit end date
          </li>
          <li>
            <kbd id="accesskey-share"
              ><span class="modifier-key">Alt</span>+H</kbd
            >
            Share progress
          </li>
        </ul>
      </div>
    </div>

    <footer id="footer">
      <div class="footer-inner">
        <p>
          Copyright &copy; 2000-<span id="current-year"></span>
          <a rel="author" href="https://www.johnsy.com/about/"
            ><em><acronym title="Peter Alexander Johns">paj</acronym></em></a
          >
          All rights (and some wrongs) reserved.
        </p>
      </div>
    </footer>

    <script type="module" src="/main.ts"></script>
    <script>
      document.getElementById("current-year").textContent =
        new Date().getFullYear();
    </script>
  </body>
</html>
